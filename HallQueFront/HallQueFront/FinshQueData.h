#pragma once
#include <afxmt.h>
#include <list>
#include "SLZData.h"
#include <string>
#include "JudyeShortMsg.h"
using namespace std;

class CFinshQueData
{
public:
	CFinshQueData(void);
	~CFinshQueData(void);
	void Add(const SLZData& data);//增加数据
	BOOL GetFinshedData(const UINT winID,SLZData& data);//获取数据,并删除
	BOOL GetFinshedData();
private:
	std::list<SLZData> m_listFinshQue;//完成队列
	std::list<CJudgeShortMsg*> m_list_shortmsg;//发送评价消息队列
	CMutex m_mtFinshQue;//完成队列锁
	CString m_filePath;//读文件路径
private:
	static UINT DoFinshedData(LPVOID pParam);
	CWinThread* m_pDoFinshedDataThread;//处理完成数据线程
	BOOL Start();
	void ReleaseListShorMsg();
	BOOL ReadJudgeShortMsg();
	BOOL SendMsgToPhone(const SLZData& data);

	void WriteErrLog(CString strErr);
	void WriteLogWithTime(CString strSockLog);			//写入错误日志
	BOOL AppendWriteFile(CString strText, CString strFileName);
	CString m_strLogFilePath;
public:
	BOOL ReFlushListShortMsg();//接口刷新出现差评发送短信的队列
};
